<!DOCTYPE html>
<html>
<head>
  <title><%= title %></title>
  <link rel="stylesheet" href="/stylesheets/style.css">
  <link rel="stylesheet" href="/stylesheets/layout.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <script src="/javascripts/main.js" defer></script>
  <style>
    .space{
      border: 2px solid rgb(75, 155, 252);
      border-radius: 3px;
      margin: 3px;
      background-color: rgb(182, 211, 255);
      width: 50%;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><%= title %></h1>

    <!-- Display Spaces -->
    <h2>Spaces</h2>
    <ul id="spaces-list">
      <% if (profile && profile.spaces) { %>
        <% profile.spaces.forEach(space => { %>
          <div class="space">
            <%= space.name %>
            <button class="delete-space" data-id="<%= space._id %>">Delete</button>
          </div>
        <% }); %>
      <% } else { %>
        <div class="space">No spaces available</div>
      <% } %>
    </ul>
    <form action="/profile" method="post">
      <input type="text" name="name" placeholder="New space">
      <button type="submit">Add Space</button>
    </form>

    <!-- Display Time Range -->
    <h2>Time Range</h2>
    <form id="time-range-form" action="/profile/time" method="post">
      <label for="startTime">Start Time:</label>
      <input type="text" id="startTime" name="startTime" value="<%= profile ? profile.startTime : '' %>">
      <label for="endTime">End Time:</label>
      <input type="text" id="endTime" name="endTime" value="<%= profile ? profile.endTime : '' %>">
      <button type="submit">Update Time Range</button>
    </form>
  </div>
</body>
<script>
  document.querySelectorAll('.delete-space').forEach(button => {
    button.addEventListener('click', async function() {
      const spaceId = this.getAttribute('data-id');
      try {
        const response = await fetch(`/profile/spaces/${spaceId}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        if (response.ok) {
          window.location.reload();
        } else {
          console.error('Failed to delete space');
        }
      } catch (error) {
        console.error('Error:', error);
      }
    });
  });
</script>
</html>